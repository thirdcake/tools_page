(()=>{var a=class{constructor(e){this.key=e,this.right=null,this.left=null,this.height=1}},u=class{constructor(){this.root=null}_getHeight(e){return e===null?0:e.height}insert(e){if(this.root===null){this.root=new a(e);return}let s=[],t=this.root;for(s.push(t);t!==null;){if(t.key<e){if(t.right===null){t.right=new a(e);break}t=t.right}else if(e<t.key){if(t.left===null){t.left=new a(e);break}t=t.left}else return;s.push(t)}s.reverse().forEach(i=>{i.height=Math.max(this._getHeight(i.right),this._getHeight(i.left))+1})}delete(e){if(this.root===null)return;let s=[],t=this.root,i=null;for(s.push(t);t!==null;){if(t.key<e)i=t,t=t.right;else if(e<t.key)i=t,t=t.left;else break;s.push(t)}if(t!==null){if(t.right===null&&t.left===null)i===null?this.root=null:(console.log(i),i.key<e?i.right=null:i.left=null);else if(t.right===null||t.left===null){let r=t.right?t.right:t.left;i===null?this.root=r:i.key<e?i.right=r:i.left=r}else{let r=t.right,n="right";for(i=t,s.push(r);r.left!==null;)i=r,r=r.left,n="left",s.push(r);t.key=r.key,r.right===null?i[n]=null:i[n]=r.right}s.reverse().forEach(r=>{r.height=Math.max(this._getHeight(r.right),this._getHeight(r.left))+1})}}rotate(e,s){let t=s==="left"?"right":"left",i=[],r=this.root,n=null;for(i.push(r);r!==null;){if(r.key<e)n=r,r=r.right;else if(e<r.key)n=r,r=r.left;else break;i.push(r)}let l=r[t];[l[s],r[t]]=[r,l[s]],n===null?this.root=l:n.left===r?n.left=l:n.right=l,i.push(l),i.push(r),i.reverse().forEach(o=>{o.height=Math.max(this._getHeight(o.right),this._getHeight(o.left))+1})}};var w=class{constructor(){this.classNamePool=[]}_createCircle(e,s,t,i,r="#fff"){let n=document.createElementNS("http://www.w3.org/2000/svg","g"),l=document.createElementNS("http://www.w3.org/2000/svg","circle"),o=document.createElementNS("http://www.w3.org/2000/svg","text");return l.setAttribute("cx",e),l.setAttribute("cy",s),l.setAttribute("r",t),l.setAttribute("fill",r),l.setAttribute("stroke","#333"),o.setAttribute("x",e),o.setAttribute("y",s),o.setAttribute("text-anchor","middle"),o.setAttribute("fill","#333"),o.textContent=i,o.setAttribute("dy","0.3em"),n.appendChild(l),n.appendChild(o),n}_createLine(e,s){let t=document.createElementNS("http://www.w3.org/2000/svg","line");return t.setAttribute("x1",e[0]),t.setAttribute("y1",e[1]),t.setAttribute("x2",s[0]),t.setAttribute("y2",s[1]),t.setAttribute("stroke","#333"),t}_int10toXY(e){let s=e.toString(2).split("");s.shift();let t=s.length,i=(e-2**t+.5)*800/2**t,r=t*100+50;return[i,r]}_getBalance(e){if(e===null)return 0;let s=e.left?e.left.height:0,t=e.right?e.right.height:0;return Math.abs(t-s)}createNode(e,s){let t=document.createElementNS("http://www.w3.org/2000/svg","g");if(e===null)return t;let[i,r]=this._int10toXY(s);t.setAttribute("transform",`translate(${i}, ${r})`),t.setAttribute("id",`node${e.key}`),t.dataset.pos=s;let n=this._getBalance(e)>1?"#f00":"#fff",l=this._createCircle(0,0,20,e.key,n),o=this._createCircle(20,-20,12,"x");if(o.dataset.clickable=!0,o.dataset.action="x",o.style.cursor="pointer",t.appendChild(l),t.appendChild(o),e.right!==null){let c=this._createCircle(-20,20,12,"L");c.dataset.clickable=!0,c.dataset.action="L",c.style.cursor="pointer",c.classList.add("lr-method"),t.appendChild(c)}if(e.left!==null){let c=this._createCircle(20,20,12,"R");c.dataset.clickable=!0,c.dataset.action="R",c.style.cursor="pointer",c.classList.add("lr-method"),t.appendChild(c)}return t}createBranch(e){let s=document.createElementNS("http://www.w3.org/2000/svg","g"),t=[];for(t.push([e,1]);t.length>0;){let[i,r]=t.pop();if(i.left!==null){let n=this._createLine(this._int10toXY(r),this._int10toXY(r*2));s.appendChild(n),t.push([i.left,r*2])}if(i.right!==null){let n=this._createLine(this._int10toXY(r),this._int10toXY(r*2+1));s.appendChild(n),t.push([i.right,r*2+1])}}return s}setAnimation(e,s){let t=e.dataset.pos|0,i=s.dataset.pos|0;if(t===i)return;let r=t<i?"reverse":"normal",n=Math.min(t,i),l=Math.max(t,i),o=`move-${n}-${l}`;if(!this.classNamePool.includes(o)){this.classNamePool.push(o);let[c,b]=this._int10toXY(n),[k,x]=this._int10toXY(l),v=document.styleSheets[0],_=`
                @keyframes ${o} {
                    from {
                        transform: translate(${c}px, ${b}px);
                    }
                    to {
                        transform: translate(${k}px, ${x}px);
                    }
                }
            `;v.insertRule(_,v.cssRules.length)}e.style.animation=`${o} 1s ${r} forwards linear`}},g=class{constructor(e){this.svg=e,this.creator=new w}render(e){let s=document.createElementNS("http://www.w3.org/2000/svg","g");if(e===null){this._resetSvg(),this.svg.appendChild(s);return}let t=this.svg.querySelector("svg>g"),i=this.creator.createBranch(e);s.appendChild(i);let r=[];for(r.push([e,1]);r.length>0;){let[n,l]=r.pop(),o=t.querySelector(`g#node${n.key}`),c=this.creator.createNode(n,l);o&&this.creator.setAnimation(c,o),s.appendChild(c),n.left!==null&&r.push([n.left,l*2]),n.right!==null&&r.push([n.right,l*2+1])}this.svg.removeChild(t),this.svg.appendChild(s)}},p=class{constructor(e){this.errorspace=e}render(e){this.errorspace.textContent=e}};var f=class{constructor(e,s,t){this.tree=e,this.svgRenderer=s,this.errorRenderer=t}},d=class extends f{constructor(e,s,t){super(e,s,t)}handleEvent(e){let s=e.target.closest("g");if(s&&s.dataset.clickable==="true"){let t=s.parentNode.closest("g"),i=Number(t.id.replace("node",""));switch(s.dataset.action){case"x":this.tree.delete(i);break;case"L":this.tree.rotate(i,"left");break;case"R":this.tree.rotate(i,"right");break}this.svgRenderer.render(this.tree.root)}}},m=class extends f{constructor(e,s,t,i){super(e,s,t),this.inputnum=i}handleEvent(e){e.preventDefault(),this.inputnum.value.split(" ").map(Number).forEach(t=>{if(isNaN(t)){this.errorRenderer.render("\u6570\u5024\u4EE5\u5916\u304C\u542B\u307E\u308C\u3066\u3044\u307E\u3059");return}this.tree.insert(t)}),this.svgRenderer.render(this.tree.root)}};window.addEventListener("DOMContentLoaded",()=>{let h=["svg","insert","inputnum","errorspace"].reduce((n,l)=>(n[l]=document.getElementById(l),n),{}),e=new u,s=new g(h.svg),t=new p(h.errorspace),i=new d(e,s,t);h.svg.addEventListener("click",i,!1);let r=new m(e,s,t,h.inputnum);h.insert.addEventListener("submit",r,!1)},!1);})();
